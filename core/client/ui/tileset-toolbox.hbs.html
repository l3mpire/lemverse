<template name="tileImg">
  <div style="display: inline-block; background-image: url('/api/files/{{tileset.fileId}}'); width: 16px; height: 16px; background-position: -{{tileToTilesetX}}px -{{tileToTilesetY}}px;"></div>
</template>

<template name="tileData">
  <div class="tileData {{#if hasCollision tilesetId index}}has-collision{{/if}}">{{> tileImg}} {{tileLayer}}</div>
</template>

<template name="tilesetToolbox">
  <div class="tileset-toolbox">
    <div>
      <div>
        <select class="js-tilesets-select">
          {{#each tilesets}}
            <option selected="{{#if eq selectedTilesId _id}}selected{{/if}}" value={{_id}}>{{name}}</option>
          {{/each}}
        </select>
      </div>
      <div class="tileset-toolbox-img">
        {{#with selectedTileset}}
          <img src="/api/files/{{fileId}}" style="width:{{zoom width 1}}px; height:{{zoom height 1}}px;" draggable="false" alt="tileset image">
        {{/with}}
        {{> marker tileIndex=(Session 'pointerTileIndex') w=1 h=1 color='#00FF00'}}

        {{#with Session 'selectedTiles'}}
          {{> marker tileIndex=index w=w h=h color='#0000FF'}}
        {{/with}}
      </div>
    </div>
    <div>
      <div class="tileset-toolbox-erase">
        <span class="button js-erase-0 {{#if eq selectedTilesIndex -1}}active{{/if}}">局0</span>
        <span class="button js-erase-1 {{#if eq selectedTilesIndex -2}}active{{/if}}">局1</span>
        <span class="button js-erase-2 {{#if eq selectedTilesIndex -3}}active{{/if}}">局2</span>
        <span class="button js-erase-3 {{#if eq selectedTilesIndex -4}}active{{/if}}">局3</span>
        <span class="button js-erase-4 {{#if eq selectedTilesIndex -5}}active{{/if}}">局4</span>
        <span class="button js-erase-5 {{#if eq selectedTilesIndex -6}}active{{/if}}">局5</span>
        <span class="button js-erase-6 {{#if eq selectedTilesIndex -7}}active{{/if}}">局6</span>
        <span class="button js-erase-7 {{#if eq selectedTilesIndex -8}}active{{/if}}">局7</span>
        <span class="button js-erase-8 {{#if eq selectedTilesIndex -9}}active{{/if}}">局8</span>
        <span class="button js-erase-all {{#if eq selectedTilesIndex -99}}active{{/if}}">局C</span>
      </div>
    </div>
    <div>
      <div class="tileset-toolbox-info">
        <div>Pointer x: {{worldToTileX (Session 'pointerX')}} y: {{worldToTileY (Session 'pointerY')}}
          {{#each pointerTile}}
            {{> tileData}}
          {{/each}}
        </div>
        {{#with Session 'selectedTiles'}}
          Selected {{> tileData}}
        {{/with}}
      </div>
    </div>
  </div>
</template>
